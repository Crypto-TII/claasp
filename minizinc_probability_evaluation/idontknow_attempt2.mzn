array[0..31, 0..7, 0..7] of -200..1: tables_lbct = array3d(0..31, 0..7, 0..7, 
[
 -200, 1, 1, 1, 1, -100, -100, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, -100, 1, 1,
 1, 1, 1, 1, 1, 1, -100, 1,
 1, 1, 1, 1, 1, 1, 1, 1,


 -100, 1, 1, -100, 1, 1, -100, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, -100, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 -100, 1, 1, 1, 1, 1, -100, 1,
 1, 1, 1, 1, 1, 1, 1, 1,


 -100, 1, 1, 1, 1, 1, -100, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, -100, 1, 1,
 -100, 1, 1, 1, 1, -100, -100, 1,
 1, 1, 1, 1, 1, 1, 1, 1,


 -100, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, -100, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 -100, 1, 1, -100, 1, 1, -200, 1,
 1, 1, 1, 1, 1, 1, 1, 1,


 1, 1, -100, 1, -100, 1, 1, 0,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, -100, 1, 1, 1, 1, 0,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, -100, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 0,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 0,


 1, 1, 1, 1, 1, 1, 1, 0,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 0,
 1, 1, 1, 1, 1, 1, 1, 0,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 0,


 1, 1, 1, 1, 1, 1, 1, 1,
 1, 0, 1, 1, 1, 1, 1, 1,
 1, 0, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 0, 1, 1, 1, 1, 1, 1,
 1, 0, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,


 1, 1, 1, 1, 1, 1, 1, 1,
 1, 0, 1, 1, 1, 1, 1, 1,
 1, 1, -100, 1, 1, 1, 1, 1,
 1, 0, 1, 1, 1, 1, 1, 1,
 1, 0, 1, 1, -100, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 0, -100, 1, -100, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,


 1, 1, -100, 1, 1, 1, 1, 0,
 1, 0, 1, 1, 1, 1, 1, 1,
 1, 0, -100, 1, 1, 1, 1, 0,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 0, 1, 1, 1, 1, 1, 0,
 1, 0, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 0,


 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, -100, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, -100, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,


 1, 1, 1, 1, -100, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, -100, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,


 1, 1, 1, 1, 1, 1, 1, 0,
 1, 0, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 0, 1, 1, 1, 1, 1, 0,
 1, 0, 1, 1, -100, 1, 1, 0,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 0, 1, 1, -100, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 0,


 -100, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 -100, 1, 1, 0, 1, -100, 1, 1,
 1, 1, 1, 0, 1, 1, 1, 1,
 1, 1, 1, 0, 1, 1, 1, 1,
 1, 1, 1, 0, 1, -100, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,


 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, -100, 1, 0, -100, 1,
 1, 1, 1, -100, 1, 0, 1, 1,
 1, 1, 1, 1, 1, 0, 1, 1,
 1, 1, 1, 1, 1, 0, 1, 1,
 1, 1, 1, 1, 1, 1, -100, 1,
 1, 1, 1, 1, 1, 1, 1, 1,


 -100, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 0, 1, 1, 1, 1,
 1, 1, 1, 0, 1, 1, 1, 1,
 -100, 1, 1, 0, 1, -100, 1, 1,
 1, 1, 1, 0, 1, -100, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,


 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 0, 1, 1,
 1, 1, 1, -100, 1, 0, 1, 1,
 1, 1, 1, -100, 1, 0, -100, 1,
 1, 1, 1, 1, 1, 0, 1, 1,
 1, 1, 1, 1, 1, 1, -100, 1,
 1, 1, 1, 1, 1, 1, 1, 1,


 1, 0, -100, 1, 1, 1, 1, -100,
 1, 0, 1, 1, 1, 1, 1, 1,
 1, 1, -100, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 0, 1, 1, 1, 1, 1, 1,
 1, 0, 1, 1, 1, 1, 1, -100,


 1, -100, 1, 1, -100, 1, 1, 0,
 1, -100, 1, 1, 1, 1, 1, 0,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, -100, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 0,
 1, 1, 1, 1, 1, 1, 1, 0,


 1, 0, 1, 1, 1, 1, 1, 1,
 1, 0, 1, 1, 1, 1, 1, 1,
 1, 1, -100, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 0, -100, 1, 1, 1, 1, -100,
 1, 0, 1, 1, 1, 1, 1, -100,


 1, 1, 1, 1, 1, 1, 1, 0,
 1, -100, 1, 1, 1, 1, 1, 0,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, -100, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, -100, 1, 1, -100, 1, 1, 0,
 1, 1, 1, 1, 1, 1, 1, 0,


 -100, 1, 1, 0, 1, 0, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 -100, 1, 1, 1, 1, 0, 1, 1,
 1, 1, 1, 0, 1, 1, 1, 1,
 1, 1, 1, 0, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 0, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 0, 1, 0, 1, 1,


 -100, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 -100, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,


 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, -100, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, -100, 1,
 1, 1, 1, 1, 1, 1, 1, 1,


 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 0, 1, 0, 1, 1,
 1, 1, 1, 1, 1, 0, 1, 1,
 1, 1, 1, 0, 1, 1, 1, 1,
 1, 1, 1, 0, 1, 1, -100, 1,
 1, 1, 1, 1, 1, 0, 1, 1,
 1, 1, 1, 0, 1, 0, -100, 1,
 1, 1, 1, 1, 1, 1, 1, 1,


 -100, 1, 1, 1, 1, 0, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 -100, 1, 1, 1, 1, 0, -100, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 0, 1, 1,
 1, 1, 1, 1, 1, 1, -100, 1,
 1, 1, 1, 1, 1, 0, 1, 1,


 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 0, 1, 1,
 1, 1, 1, 1, 1, 0, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 0, 1, 1,
 1, 1, 1, 1, 1, 0, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,


 1, 1, 1, 0, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 0, 1, 1, 1, 1,
 1, 1, 1, 0, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 0, 1, 1, 1, 1,


 -100, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 0, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 0, 1, 1, 1, 1,
 -100, 1, 1, 0, 1, 1, -100, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 0, 1, 1, -100, 1,
 1, 1, 1, 1, 1, 1, 1, 1,


 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, -200, 1, -100, 1, 1, -100,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, -100, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, -100,


 1, 1, 1, 1, 1, 1, 1, 1,
 1, -100, 1, 1, 1, 1, 1, 1,
 1, -100, -100, 1, -100, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, -100, 1, -100, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,


 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, -100, 1, -100, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, -100, 1, -100, 1, 1, -100,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, -100,


 1, 1, 1, 1, 1, 1, 1, 1,
 1, -100, 1, 1, 1, 1, 1, 1,
 1, 1, -100, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, -100, -100, 1, -200, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1,
 1, 1, 1, 1, 1, 1, 1, 1]);
 
array[0..7,0..1] of 0..1: valid_state_lbct = array2d(0..7,0..1,
[
0,0,%lsb is the first one, msb the last one
1,0,
1,0,
0,0,
1,0,
0,0,
0,0,
1,0
]);

 
int: nbit = 16;

array[0..15] of var 0..1: dL = array1d(0..16-1, [0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0]);
array[0..15] of var 0..1: dR = array1d(0..16-1, [1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0]);
array[0..15] of var 0..1: nL = array1d(0..16-1, [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);
array[0..15] of var 0..1: nR = array1d(0..16-1, [0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0]);
array[0..15] of var 0..1: nLL = array1d(0..16-1, [1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0]);

predicate lbct_probability(
    array[0..nbit-1] of var 0..1: dL,
    array[0..nbit-1] of var 0..1: dR,
    array[0..nbit-1] of var 0..1: nL,
    array[0..nbit-1] of var 0..1: nR,
    array[0..nbit-1] of var 0..1: nLL,
    array[1..nbit-1,0..7] of var int: dp_lbct,
    array[2..nbit, 0..7] of var int: app,
    array[1..nbit-1, 0..7] of var 0..7: how_many_cross_elements_differ_from_0_in_the_dp_lbct,
    var 0..4: how_many_cross_elements_differ_from_0_in_the_dp_lbct_last_condition,
    var int: lbct_prob
) =
let {
%     array[1..nbit-1,0..7] of var int: dp_lbct;
    array[1..nbit-1] of var 0..31: tmp0;
%     array[1..nbit-1, 0..7] of var 0..7: how_many_cross_elements_differ_from_0_in_the_dp_lbct;
%     var 0..4: how_many_cross_elements_differ_from_0_in_the_dp_lbct_last_condition;
%     array[2..nbit, 0..7] of var int: app;
    var int: lbct_value;
} in
(
    tmp0[1] = nLL[nbit-1]*16 + nR[nbit-1]*8 + nL[nbit-1]*4 + dR[nbit-1]*2 + dL[nbit-1]
    /\
    forall(j in 0..7)(
        dp_lbct[1,j] = tables_lbct[tmp0[1],j,0]
    )
    /\
%     how_many_cross_elements_differ_from_0_in_the_dp_lbct[0] = sum(j in 0..7)(if dp_lbct[1,j] <= 0 then 1 else 0 endif)
%     /\    
    forall(i in 2..nbit-1, j in 0..7)(
        tmp0[i] = nLL[nbit-i]*16 + nR[nbit-i]*8 + nL[nbit-i]*4 + dR[nbit-i]*2 + dL[nbit-i]
        /\
        how_many_cross_elements_differ_from_0_in_the_dp_lbct[i,j] = sum(k in 0..7)(
                    if tables_lbct[tmp0[i],j,k] <= 0 /\ dp_lbct[i-1,k]<=0 then 1 else 0 endif
        )
        /\
        (how_many_cross_elements_differ_from_0_in_the_dp_lbct[i,j] = 0
              -> dp_lbct[i,j] = 1
        )
        /\
        (how_many_cross_elements_differ_from_0_in_the_dp_lbct[i,j] = 1 ->
            dp_lbct[i,j] = sum(k in 0..7)(
                if tables_lbct[tmp0[i],j,k] <= 0 /\ dp_lbct[i-1,k]<=0 then dp_lbct[i-1,k] + tables_lbct[tmp0[i],j,k]
                else 0 endif
            )
         )
         /\
         (how_many_cross_elements_differ_from_0_in_the_dp_lbct[i,j] = 2
            -> (
                  app[i,j] = sum(k in 0..7)(
                    if tables_lbct[tmp0[i],j,k] <= 0 /\ dp_lbct[i-1,k]<=0 then dp_lbct[i-1,k] + tables_lbct[tmp0[i],j,k]
                    else 0 endif
                  )
                  /\
                  dp_lbct[i,j] = -(100-18*(abs(app[i,j] div 100)-2)*(abs(app[i,j] div 100)-6))
            )
         )
         /\
         (how_many_cross_elements_differ_from_0_in_the_dp_lbct[i,j] = 3
            -> (
                  app[i,j] = sum(k in 0..7)(
                    if tables_lbct[tmp0[i],j,k] <= 0 /\ dp_lbct[i-1,k]<=0 then dp_lbct[i-1,k] + tables_lbct[tmp0[i],j,k]
                    else 0 endif
                  )
                  /\
                  dp_lbct[i,j] = -(158-8*(app[i,j]-3)*(app[i,j]-9))
            )
         )
    )
    /\
    how_many_cross_elements_differ_from_0_in_the_dp_lbct_last_condition = sum(state in 0..7)(if 
              (valid_state_lbct[state,0]
              + valid_state_lbct[state,1]
              + nLL[1] + nR[1] + nL[1]) mod 2 = 0 /\ dp_lbct[nbit-1,state] <= 0 then 1 else 0 endif)
    /\
    (how_many_cross_elements_differ_from_0_in_the_dp_lbct_last_condition = 0 -> lbct_value = 3200) 
    /\
    (how_many_cross_elements_differ_from_0_in_the_dp_lbct_last_condition = 1 -> 
            lbct_value = -200 + sum(state in 0..7)(
                  if (valid_state_lbct[state,0]
                      + valid_state_lbct[state,1]
                      + nLL[1] + nR[1] + nL[1]) mod 2 = 0 /\ dp_lbct[nbit-1,state] <= 0
                 then dp_lbct[nbit-1,state]
                 else 0
                 endif
            ) + 3200
     ) 
     /\
     (
     how_many_cross_elements_differ_from_0_in_the_dp_lbct_last_condition = 2 -> 
            (
                  app[nbit,0] = sum(k in 0..7)(
                    if (valid_state_lbct[k,0]
                      + valid_state_lbct[k,1]
                      + nLL[1] + nR[1] + nL[1]) mod 2 = 0  /\ dp_lbct[nbit-1,k]<=0 then dp_lbct[nbit-1,k]
                    else 0 endif
                  )
                  /\
                  lbct_value= -200 - (100-18*(app[nbit,0]-2)*(app[nbit,0]-6)) + 3200
            )
     )
     /\
     (how_many_cross_elements_differ_from_0_in_the_dp_lbct_last_condition = 3 -> 
            (
                  app[nbit,0] = sum(k in 0..7)(
                    if (valid_state_lbct[k,0]
                      + valid_state_lbct[k,1]
                      + nLL[1] + nR[1] + nL[1]) mod 2 = 0  /\ dp_lbct[nbit-1,k]<=0 then dp_lbct[nbit-1,k]
                    else 0 endif
                  )
                  /\
                  lbct_value= -200 - (158-8*(app[nbit,0]-3)*(app[nbit,0]-9)) + 3200
            )
     )
     /\
     (how_many_cross_elements_differ_from_0_in_the_dp_lbct_last_condition = 4 -> 
            (
                  app[nbit,0] = sum(k in 0..7)(
                    if (valid_state_lbct[k,0]
                      + valid_state_lbct[k,1]
                      + nLL[1] + nR[1] + nL[1]) mod 2 = 0  /\ dp_lbct[nbit-1,k]<=0 then dp_lbct[nbit-1,k]
                    else 0 endif
                  )
                  /\
                  lbct_value= -200 - (200-4*(app[nbit,0]-4)*(app[nbit,0]-20)) + 3200
            )
     )
    /\
    lbct_prob = lbct_value
);
var int: lbct_prob;
array[2..nbit, 0..7] of var int: app;
var 0..4: how_many_cross_elements_differ_from_0_in_the_dp_lbct_last_condition;
array[1..nbit-1, 0..7] of var 0..7: how_many_cross_elements_differ_from_0_in_the_dp_lbct;
array[1..nbit-1,0..7] of var int: dp_lbct;
constraint lbct_probability(dL, dR, nL, nR, nLL, dp_lbct, app, how_many_cross_elements_differ_from_0_in_the_dp_lbct, how_many_cross_elements_differ_from_0_in_the_dp_lbct_last_condition, lbct_prob);

output[
      "lbct_entry/2^32 = \(lbct_prob)" ++ 
      "\n \(how_many_cross_elements_differ_from_0_in_the_dp_lbct_last_condition) \n",
      concat([
          concat(["how_many_cross_elements_differ_from_0_in_the_dp_lbct[\(i),\(state)] = \(how_many_cross_elements_differ_from_0_in_the_dp_lbct[i,state]) \n" | state in 0..7]) ++ "\n" | i in 1..nbit-1
      ]),
      concat([
          concat(["dp_lbct[\(i),\(state)] = \(dp_lbct[i,state]) \n" | state in 0..7]) ++ "\n" | i in 1..nbit-1
      ]),
      concat([
          concat(["app[\(i),\(state)] = \(app[i,state]) \n" | state in 0..7]) ++ "\n" | i in 2..nbit-1
      ])
      ];